<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cuestionario</title>
  <style>
    body {
      font-family: 'Comic Sans MS', Arial, sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      padding: 20px;
    }
    .container {
      max-width: 700px;
      background: white;
      padding: 25px;
      border-radius: 20px;
      margin: auto;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      position: relative;
      z-index: 2;
    }
    h1 { color: #ff6f61; }
    .question { display: none; animation: fadeIn 0.6s ease; }
    .question.active { display: block; }
    label {
      display: block;
      margin: 8px 0;
      padding: 10px;
      border-radius: 10px;
      background: #f0f0f0;
      cursor: pointer;
    }
    label:hover { background: #ffe0e0; }
    button {
      margin-top: 15px;
      padding: 12px 25px;
      font-size: 16px;
      border: none;
      border-radius: 25px;
      background: #ff6f61;
      color: white;
      cursor: pointer;
    }
    button:disabled { background: gray; }
    .feedback { margin-top: 10px; font-weight: bold; }
    .correct { color: green; }
    .incorrect { color: red; }
    canvas#confetti {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 1;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="container">
  <h1>Cuestionario final</h1>

  <div id="progress-container" style="width:100%;background:#eee;border-radius:20px;overflow:hidden;margin-bottom:20px;">
    <div id="progress-bar" style="width:0%;height:18px;background:linear-gradient(90deg,#ff6f61,#ffb347);transition:width 0.4s ease;"></div>
  </div>

  <!-- PREGUNTAS -->
  <div class="question active" data-correct="d">
    <p>1. Â¿CuÃ¡l es el mejor grupo de clase?</p>
    <label><input type="radio" name="q1" value="a"> Los raris</label>
    <label><input type="radio" name="q1" value="b"> Las majos</label>
    <label><input type="radio" name="q1" value="c"> Las fachas</label>
    <label><input type="radio" name="q1" value="d"> Imserso temporal 24-25</label>
    <div class="feedback"></div>
    <button onclick="nextQuestion(this)">Responder</button>
  </div>

  <div class="question" data-correct="b">
    <p>2. Â¿Enrique o JoaquÃ­n?</p>
    <label><input type="radio" name="q2" value="a"> Enrique</label>
    <label><input type="radio" name="q2" value="b"> JoaquÃ­n</label>
    <div class="feedback"></div>
    <button onclick="nextQuestion(this)">Responder</button>
  </div>

  <div class="question" data-correct="c">
    <p>3. Â¿QuiÃ©n es el prota de los videos del mes?</p>
    <label><input type="radio" name="q3" value="a"> La madre de Claudia</label>
    <label><input type="radio" name="q3" value="b"> Esmeralda y su culo</label>
    <label><input type="radio" name="q3" value="c"> Hugo</label>
    <label><input type="radio" name="q3" value="d"> Bianca</label>
    <div class="feedback"></div>
    <button onclick="nextQuestion(this)">Responder</button>
  </div>

  <div class="question" data-correct="a,b,d">
    <p>4. Â¿A quiÃ©n vas a echar mÃ¡s de menos?</p>
    <label><input type="radio" name="q4" value="a"> Hugo</label>
    <label><input type="radio" name="q4" value="b"> Hugo</label>
    <label><input type="radio" name="q4" value="c"> LucÃ­a</label>
    <label><input type="radio" name="q4" value="d"> Hugo</label>
    <div class="feedback"></div>
    <button onclick="nextQuestion(this)">Responder</button>
  </div>

  <div class="question" data-correct="c">
    <p>5. Â¿QuÃ© carrera estÃ¡s estudiando?</p>
    <label><input type="radio" name="q5" value="a"> IngenierÃ­a de caminos</label>
    <label><input type="radio" name="q5" value="b"> GeografÃ­a</label>
    <label><input type="radio" name="q5" value="c"> EducaciÃ³n infantil</label>
    <label><input type="radio" name="q5" value="d"> Pinta y colorea</label>
    <div class="feedback"></div>
    <button onclick="nextQuestion(this)">Responder</button>
  </div>

  <div class="question" data-correct="a">
    <p>6. Â¿Carlos Peguer es mÃ¡s guapo en persona?</p>
    <label><input type="radio" name="q6" value="a"> SÃ­</label>
    <label><input type="radio" name="q6" value="b"> No</label>
    <div class="feedback"></div>
    <button onclick="nextQuestion(this)">Finalizar</button>
  </div>

  <div class="question" id="final"></div>
</div>

<!-- AUDIOS -->
<audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
<audio id="wrongSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>
<audio id="winSound" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>
<audio id="loseSound" src="https://www.soundjay.com/human/sounds/boo-01.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let score = 0;
let totalQuestions = document.querySelectorAll('.question').length - 1;
let currentQuestion = 1;
let answered = 0;

function nextQuestion(button) {
  updateProgress();

  const q = button.parentElement;
  const correct = q.dataset.correct.split(',');
  const selected = q.querySelector('input[type=radio]:checked');
  const feedback = q.querySelector('.feedback');

  if (!selected) {
    alert('Selecciona una respuesta');
    return;
  }

  answered++;
  currentQuestion++;

  if (correct.includes(selected.value)) {
    score++;
    feedback.textContent = 'Respuesta correcta';
    feedback.className = 'feedback correct';
    document.getElementById('correctSound').play();
  } else {
    feedback.textContent = 'Respuesta incorrecta';
    feedback.className = 'feedback incorrect';
    document.getElementById('wrongSound').play();
  }

  button.disabled = true;

  setTimeout(() => {
    q.classList.remove('active');
    const next = q.nextElementSibling;
    if (next) next.classList.add('active');
    if (next && next.id === 'final') showResults();
  }, 1200);
}

function updateProgress() {
  const percent = Math.min((currentQuestion - 1) / totalQuestions * 100, 100);
  document.getElementById('progress-bar').style.width = percent + '%';
}

function showResults() {
  const final = document.getElementById('final');
  const aprobado = score >= Math.ceil(answered / 2);

  if (aprobado) {
    document.getElementById('winSound').play();
    explodeConfetti();
  } else {
    document.getElementById('loseSound').play();
  }

  final.innerHTML = `
    <h2>${aprobado ? 'ðŸŽ‰ Â¡ENHORABUENA!' : 'ðŸ˜… Casi lo tienes'}</h2>
    <p>PuntuaciÃ³n: <strong>${score} / ${answered}</strong></p>
    <canvas id="chart" width="300" height="300"></canvas>
    <p><a href="https://www.canva.com/design/DAG-PvP8d7Q/shDkadqD-zzZ1iZQOQoyZQ/edit" target="_blank">Continuar</a></p>
  `;

  new Chart(document.getElementById('chart'), {
    type: 'pie',
    data: {
      labels: ['Aciertos', 'Fallos'],
      datasets: [{ data: [score, answered - score] }]
    }
  });
}

/* CONFETTI */
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let pieces = [];

function explodeConfetti() {
  const leftX = canvas.width * 0.25;
  const rightX = canvas.width * 0.75;
  const centerY = canvas.height * 0.35;

  for (let i = 0; i < 180; i++) {
    pieces.push({ x: leftX, y: centerY, r: Math.random()*6+3, vx: Math.random()*4+1, vy: Math.random()*-6-3 });
    pieces.push({ x: rightX, y: centerY, r: Math.random()*6+3, vx: Math.random()*-4-1, vy: Math.random()*-6-3 });
  }
  animateConfetti();
}

function animateConfetti() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  pieces.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
    p.y += p.vy;
    p.x += p.vx;
  });
  requestAnimationFrame(animateConfetti);
}
</script>

</body>
</html>